<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.it.every.post.model.PostDAO">
	<!-- 개설교과목공지 글 읽어오기 -->
	<select id="postByOpenSubCode" parameterType="int" resultType="postVo">
		select * from post p
		where bd_code = #{bdCode}
		order by post_no desc
	</select>
	<!-- 개설교과목공지 글 등록 -->
	<insert id="insertNoitce" parameterType="postVo">
		insert into post(post_no, bd_code, writer_code, title, contents, reg_date, read_count)
		values(POST_SEQ.nextval, #{bdCode}, #{writerCode}, #{title}, #{contents}, sysdate, 0)
	</insert>
	<!-- 개설교과목공지 글 수정 -->
	<update id="editNotice" parameterType="postVo">
		update post
		set title=#{title}, contents=#{contents}, edit_date=sysdate
		where post_no = #{postNo}
	</update>
	<!-- post_no로 게시글 불러오기 -->
	<select id="postByPostNo" parameterType="int" resultType="map">
		select p.*, b.* from post p
		join board b
		on p.bd_code = b.bd_code
		where post_no = #{postNo}
	</select>
	
	<!-- post_no로 contents내용 부르기 -->
	<resultMap type="string" id="CONTENTS_CLOB">
		<result property="contents" column="contents" jdbcType="CLOB" javaType="java.lang.String"/>
	</resultMap>
	
	<select id="contentsByPostNo" parameterType="int" resultMap="CONTENTS_CLOB">
		select contents from post
		where post_no = #{postNo}
	</select>
	
	<!-- 조회수 증가 -->
	<update id="noticeReadCount" parameterType="int">
		update post
		set read_count = read_count+1
		where post_no = #{postNo}
	</update>
	
	<!-- post 삭제 -->
	<delete id="deletePostByPostNo">
		delete from post
		where post_no = #{postNo}
	</delete>
	
	
	<!-- 중고게시판 상품 디테일-->
	<select id="selectByJunggoPostNo" parameterType="int" resultType="map">
		select * from post post left join board_file bf 
		on post.post_no = bf.post_no
		where post.post_no=#{postNo}
	</select>
	
	<update id="updateByJunggoPostNo" parameterType="int">
		update post 
		set del_flag='C'
		where post_no=#{postNo}
	</update>
	
	
	
	<select id="selectByNoticeStudent" parameterType="String" resultType="map">
		select post.post_no, subj.*, to_char(post.reg_date, 'YYYY-MM-DD') as reg_date ,regi.*,board.*,post.title,post.writer_code,post.read_count from registration regi join board board
		on regi.open_sub_code = board.open_sub_code
		join post post
		on post.bd_code = board.bd_code
		join open_subj os
		on os.open_sub_code = regi.open_sub_code
		join subject subj
		on subj.subj_code = os.subj_code
		where stu_no=#{stuNo}
		<!-- <if test='opensubcode!=0'>and subj_year=#{subjYear} </if>  -->
	</select>
	
	<select id="selectByNoticeStudentMap" parameterType="int" resultType="map">
		select post.post_no, subj.*, to_char(post.reg_date, 'YYYY-MM-DD') as reg_date ,regi.*,board.*,post.title,post.writer_code,post.read_count from registration regi join board board
		on regi.open_sub_code = board.open_sub_code
		join post post
		on post.bd_code = board.bd_code
		join open_subj os
		on os.open_sub_code = regi.open_sub_code
		join subject subj
		on subj.subj_code = os.subj_code
		where stu_no=#{stuNo}
		<!-- <if test='opensubcode!=0'>and subj_year=#{subjYear} </if>  -->
	</select>
	
	
</mapper>









